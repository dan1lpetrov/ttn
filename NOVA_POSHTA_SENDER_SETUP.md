# Інструкція: Створення контрагента-відправника в Nova Poshta

## Проблема
API Nova Poshta не дозволяє створювати контрагентів типу "Sender" (Відправник) через API. Можна створювати тільки "Recipient" (Отримувач).

## Рішення 1: Автоматичне створення через ContactPersonGeneral (РЕКОМЕНДОВАНО)

Додаток тепер автоматично створює контактну особу для контрагента через метод `ContactPersonGeneral.save`. Це дозволяє використовувати контрагента типу "Recipient" як відправника.

**Процес:**
1. Створюється контрагент типу "Recipient"
2. Створюється контактна особа для цього контрагента через `ContactPersonGeneral.save`
3. Контактна особа дозволяє використовувати контрагента як відправника

**Це працює автоматично при створенні відправника через форму!**

## Рішення 2: Створити відправника вручну в особистому кабінеті Nova Poshta

### Крок 1: Увійти в особистий кабінет Nova Poshta
1. Перейдіть на сайт [https://novaposhta.ua](https://novaposhta.ua)
2. Увійдіть в особистий кабінет (використовуйте той самий акаунт, з якого отримали API ключ)

### Крок 2: Створити контрагента-відправника
1. Перейдіть в розділ **"Контрагенти"** або **"Мої контрагенти"**
2. Натисніть **"Додати контрагента"** або **"Створити контрагента"**
3. Заповніть форму:
   - **Тип контрагента**: Виберіть **"Відправник"** (Sender)
   - **Ім'я**: Введіть ім'я
   - **Прізвище**: Введіть прізвище
   - **Телефон**: Введіть номер телефону
   - **Місто**: Виберіть місто відправки
   - **Відділення**: Виберіть відділення відправки
4. Збережіть контрагента

### Крок 3: Отримати Ref контрагента
1. Після створення контрагента, знайдіть його в списку контрагентів
2. Відкрийте деталі контрагента
3. Знайдіть поле **"Ref"** або **"Ідентифікатор"** - це і є Ref контрагента
4. Скопіюйте цей Ref

### Крок 4: Отримати Ref адреси відправника
1. В деталях контрагента знайдіть розділ **"Адреси"**
2. Виберіть адресу відправки (відділення)
3. Знайдіть поле **"Ref"** адреси - це і є Ref адреси відправника
4. Скопіюйте цей Ref

### Крок 5: Оновити базу даних
Після отримання Ref контрагента та адреси, оновіть запис відправника в базі даних:

```sql
UPDATE sender 
SET 
    sender_ref = 'REF_КОНТРАГЕНТА_ВІДПРАВНИКА',
    sender_address_ref = 'REF_АДРЕСИ_ВІДПРАВНИКА',
    contact_sender_ref = 'REF_КОНТАКТНОЇ_ОСОБИ'
WHERE id = 'ID_ВІДПРАВНИКА';
```

Або через Supabase Dashboard:
1. Відкрийте таблицю `sender`
2. Знайдіть запис відправника
3. Оновіть поля:
   - `sender_ref` - Ref контрагента-відправника
   - `sender_address_ref` - Ref адреси відправника
   - `contact_sender_ref` - Ref контактної особи (зазвичай такий самий як sender_ref)

### Альтернативний спосіб: Використання API для отримання Ref
Якщо ви вже створили контрагента вручну, можна отримати його Ref через API:

```bash
curl -X POST https://api.novaposhta.ua/v2.0/json/ \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "ВАШ_API_КЛЮЧ",
    "modelName": "Counterparty",
    "calledMethod": "getCounterparties",
    "methodProperties": {
      "CounterpartyProperty": "Sender"
    }
  }'
```

Це поверне список всіх контрагентів-відправників з їх Ref.

## Важливо
- Контрагент-відправник має бути створений вручну в особистому кабінеті Nova Poshta
- Використовуйте той самий акаунт, з якого отримали API ключ
- Після оновлення Ref в базі даних, створення ТТН має працювати

